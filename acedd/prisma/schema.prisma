generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider  = "postgresql"
  // Note: url and shadowDatabaseUrl are configured in prisma.config.ts (Prisma 7+)
}

// ============================================================================
// Admin & Authentication
// ============================================================================

model AdminUser {
  id           String    @id @default(uuid())
  name         String
  email        String    @unique
  passwordHash String
  role         AdminRole @default(ADMIN)
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
}

// ============================================================================
// Announcements (Duyurular)
// ============================================================================

model Announcement {
  id        String   @id @default(uuid())
  title     String
  summary   String?  @db.Text
  content   String   @db.Text
  category  String   // esnek bırakıyoruz, ileride enum'a dönebilir
  startsAt  DateTime?
  endsAt    DateTime?
  isPinned  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isPinned])
  @@index([startsAt])
}

// ============================================================================
// Members (Üyeler)
// ============================================================================

model Member {
  id            String         @id @default(uuid())
  firstName     String
  lastName      String
  gender        MemberGender
  email         String         @unique
  phone         String?
  birthDate     DateTime
  placeOfBirth  String
  currentAddress String        @db.Text
  tcId          String?        // TC Kimlik No (identityNumber için kullanılacak)
  lastValidDate DateTime?
  titles        String         @db.Text // JSON array olarak saklanacak
  status        MemberStatus   @default(ACTIVE)
  membershipDate DateTime
  // Yeni alanlar (opsiyonel)
  department    String?        // Bölüm
  graduationYear Int?           // Mezuniyet yılı
  occupation    String?        // Meslek
  // Sprint 5: Üye türü ve etiketler
  membershipKind MembershipKind @default(MEMBER)
  tags          Json?          // MemberTag array: ["HONORARY_PRESIDENT", "FOUNDING_PRESIDENT", etc.]
  // Sprint 15: Membership Application'dan gelen yeni alanlar
  bloodType     BloodType?     // Kan grubu
  city          String?        // İkamet edilen şehir
  // Sprint 17: CV Upload
  cvDatasetId   String?        // CV PDF dosyası için Dataset ID
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  boardMemberships BoardMember[]

  @@index([email])
  @@index([status])
  @@index([membershipDate])
  @@index([membershipKind])
  @@index([tcId])
}

enum MemberGender {
  erkek
  kadın
}

enum MemberAcademicLevel {
  ilkokul
  ortaokul
  lise
  onlisans
  lisans
  yukseklisans
  doktora
}

enum MemberMaritalStatus {
  bekar
  evli
  dul
  bosanmis
}

enum MemberStatus {
  ACTIVE
  INACTIVE
}

enum MembershipKind {
  MEMBER
  VOLUNTEER
}

// Sprint 15.1: Kan Grubu Enum
enum BloodType {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

// ============================================================================
// Membership Applications (Üyelik Başvuruları)
// ============================================================================

model MembershipApplication {
  id                  String                    @id @default(uuid())
  // Sprint 15.1: Yeni form alanları (zorunlu)
  firstName           String
  lastName            String
  identityNumber      String                    // TC Kimlik No (11 haneli)
  gender              MemberGender
  bloodType           BloodType?
  birthPlace          String
  birthDate           DateTime
  city                String
  phone               String
  email               String
  address             String                    @db.Text
  conditionsAccepted  Boolean                   @default(false)
  // Sprint 15.1: Durum ve İnceleme
  status              ApplicationStatus         @default(PENDING)
  applicationDate     DateTime                  @default(now())
  reviewedAt          DateTime?
  reviewedBy          String?                   // AdminUser ID
  notes               String?                   @db.Text
  // Sprint 15.1: Future-proof alanlar (şimdilik kullanılmayacak ama schema modular)
  // cvUrl              String?                   // İleride CV upload için (şimdilik kapalı)
  // documents          Json?                     // İleride ek belgeler için (şimdilik kapalı)
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt

  @@index([email])
  @@index([status])
  @@index([applicationDate])
  @@index([identityNumber])
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============================================================================
// Board Members (Yönetim Kurulu Üyeleri)
// ============================================================================

enum BoardRole {
  PRESIDENT
  VICE_PRESIDENT
  SECRETARY_GENERAL
  TREASURER
  BOARD_MEMBER
}

model BoardMember {
  id        String      @id @default(uuid())
  memberId String
  member   Member      @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  role      BoardRole
  termStart DateTime?
  termEnd   DateTime?
  
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([memberId])
  @@index([role])
}

// ============================================================================
// Events (Etkinlikler)
// ============================================================================

model Event {
  id              String   @id @default(uuid())
  title           String
  description     String   @db.Text
  shortDescription String  @db.Text
  date            DateTime
  location        String
  images          String   @db.Text // JSON array olarak saklanacak (Dataset ID'leri)
  featuredImage   String?  // Dataset ID
  isFeatured      Boolean  @default(false)
  requirements    String?  @db.Text // JSON array olarak saklanacak
  benefits        String?  @db.Text // JSON array olarak saklanacak
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([date])
  @@index([isFeatured])
}

// ============================================================================
// Scholarship Applications (Burs Başvuruları)
// ============================================================================

model ScholarshipApplication {
  id                              String                      @id @default(uuid())
  // Genel Bilgi (General Information)
  firstName                       String
  lastName                        String
  phone                           String
  alternativePhone                String?                     // Alternatif iletişim numarası
  email                           String                      @unique
  birthDate                       DateTime
  gender                          String                      // "Erkek" | "Kadın"
  birthPlace                      String
  hometown                        String
  nationalId                      String                      // TC Kimlik No (formerly tcNumber)
  idIssueDate                     DateTime
  idIssuePlace                    String
  maritalStatus                   String                      // "Bekar" | "Evli" | "Boşanmış" | "Dul"
  // Banka Bilgileri (Bank Information)
  bankName                        String                      // Banka adı (formerly bankAccount)
  iban                            String                      // IBAN NO (formerly ibanNumber)
  // Üniversite Bilgileri (University Information)
  university                      String
  faculty                         String
  department                      String
  classYear                       String                      // Sınıf bilgisi (formerly grade)
  turkiyeRanking                  Int?                        // Türkiye sıralaması (formerly turkeyRanking)
  // Sağlık ve Engellilik (Health & Disability)
  hasPhysicalDisability           String                      // "Evet" | "Hayır" (formerly physicalDisability)
  hasHealthIssue                  String                      // "Evet" | "Hayır" (formerly healthProblem)
  // Aile Bilgileri (Family Information)
  familyMonthlyIncome             Float
  familyMonthlyMandatoryExpenses  Float                       // Aylık zorunlu gider (formerly familyMonthlyExpenses)
  hasScholarshipOrLoan            String                      // "Evet" | "Hayır" (formerly scholarshipIncome)
  // Adres Bilgileri (Address Information)
  permanentAddress                String                      @db.Text
  currentAccommodation            String                      @db.Text
  // Ek Bilgiler (Additional Information)
  aboutYourself                   String                      @db.Text // Kendini tanıt (formerly selfIntroduction)
  interests                       String?                     @db.Text
  documents                       Json?                       // documents array (Dataset ID'leri) - Future use
  // Durum ve İnceleme (Status & Review)
  status                          ScholarshipApplicationStatus @default(PENDING)
  reviewedBy                      String?                     // AdminUser ID
  reviewedAt                      DateTime?
  reviewNotes                     String?                     @db.Text
  // Metadata
  createdAt                       DateTime                    @default(now())
  updatedAt                       DateTime                    @updatedAt
  // Relations
  relatives                       Relative[]
  educationHistory                EducationHistory[]
  references                      Reference[]

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([nationalId])
}

enum ScholarshipApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

// ============================================================================
// Scholarship Application - Relatives (Akrabalar)
// ============================================================================

model Relative {
  id                String                @id @default(uuid())
  applicationId     String
  application       ScholarshipApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // Akraba Bilgileri
  degree            String                // Akrabalık derecesi (formerly kinship): "Anne", "Baba", "Kardeş", "Eş", "Çocuk", vb.
  firstName         String
  lastName          String
  birthDate         DateTime
  educationStatus   String                // Öğrenim durumu (formerly education)
  occupation        String                // Meslek
  workplace         String                // İş yeri/bölüm (formerly job)
  healthInsurance   String                // Sağlık Sigortası: "Var", "Yok", "SGK", "Özel", vb.
  healthDisability  String                // Sağlık engeli: "Evet" | "Hayır"
  income            Float                 // Gelir (TL)
  phone             String
  notes             String?               @db.Text // Eklemek istedikleriniz (formerly additionalNotes)
  // Metadata
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  @@index([applicationId])
}

// ============================================================================
// Scholarship Application - Education History (Eğitim Geçmişi)
// ============================================================================

model EducationHistory {
  id              String                @id @default(uuid())
  applicationId   String
  application     ScholarshipApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // Okul Bilgileri
  schoolName      String                // Gittiğiniz Okul
  startDate       DateTime              // Başlama
  endDate         DateTime?             // Bitiş (opsiyonel)
  isGraduated     Boolean               // Mezuniyet (formerly graduation: "Evet"/"Hayır")
  department      String                // Bölüm
  gradePercent    Float                 // Yüzde (0-100, formerly percentage)
  // Metadata
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([applicationId])
}

// ============================================================================
// Scholarship Application - References (Referanslar)
// ============================================================================

model Reference {
  id              String                @id @default(uuid())
  applicationId   String
  application     ScholarshipApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // Referans Bilgileri
  relationship    String                // İlişki: "Hoca", "İş Arkadaşı", "Akraba", vb.
  firstName       String                // İsim (fullName ayrıldı)
  lastName        String                // Soyisim
  isAceddMember   Boolean               // ACEDD üyesi mi? (formerly isAcddMember: "Evet"/"Hayır")
  job             String                // İş/Meslek
  address         String                @db.Text // Adres
  phone           String                // Telefon
  // Metadata
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([applicationId])
}

// ============================================================================
// Contact Messages (İletişim Mesajları)
// ============================================================================

model ContactMessage {
  id          String                @id @default(uuid())
  fullName    String
  email       String
  phone       String?
  subject     String
  message     String                @db.Text
  // Opsiyonel metadata
  ipAddress   String?
  userAgent   String?
  status      ContactMessageStatus  @default(NEW)
  createdAt   DateTime              @default(now())
  readAt      DateTime?
  archivedAt  DateTime?

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

enum ContactMessageStatus {
  NEW
  READ
  ARCHIVED
}

// ============================================================================
// Dataset (Görsel/Dosya Yönetimi)
// ============================================================================

model Dataset {
  id            String   @id @default(uuid())
  name          String
  description   String?  @db.Text
  category      String
  fileUrl       String   @db.Text // Base64 data URL (TEXT: ~1GB in PostgreSQL, sufficient for 16MB+)
  fileName      String
  fileSize      Int      // bytes
  fileType      String   // MIME type
  tags          String?  @db.Text // JSON array olarak saklanacak
  isPublic      Boolean  @default(true)
  downloadCount Int      @default(0)
  uploadedBy    String
  source        String   // 'event-upload', 'announcement-upload', vb.
  eventId       String?  // İlişkili event ID (opsiyonel)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([category])
  @@index([source])
  @@index([eventId])
  @@index([createdAt])
}

// ============================================================================
// Settings (Site Ayarları)
// ============================================================================

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique // Dot notation: site.name, contact.email, social.instagram, etc.
  value     Json?    // Flexible value storage (string, object, array)
  updatedAt DateTime @updatedAt
  updatedBy String?  // AdminUser ID

  @@index([key])
  @@index([updatedAt])
}
