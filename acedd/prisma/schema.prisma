generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql" // MariaDB için mysql kullanıyoruz
  // Note: url and shadowDatabaseUrl are now configured in prisma.config.ts (Prisma 7+)
}

// ============================================================================
// Admin & Authentication
// ============================================================================

model AdminUser {
  id           String    @id @default(uuid())
  name         String
  email        String    @unique
  passwordHash String
  role         AdminRole @default(ADMIN)
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
}

// ============================================================================
// Announcements (Duyurular)
// ============================================================================

model Announcement {
  id        String   @id @default(uuid())
  title     String
  summary   String?  @db.Text
  content   String   @db.Text
  category  String   // esnek bırakıyoruz, ileride enum'a dönebilir
  startsAt  DateTime?
  endsAt    DateTime?
  isPinned  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([isPinned])
  @@index([startsAt])
}

// ============================================================================
// Members (Üyeler)
// ============================================================================

model Member {
  id            String         @id @default(uuid())
  firstName     String
  lastName      String
  gender        MemberGender
  email         String         @unique
  phone         String?
  birthDate     DateTime
  academicLevel MemberAcademicLevel
  maritalStatus MemberMaritalStatus
  hometown      String
  placeOfBirth  String
  nationality   String
  currentAddress String        @db.Text
  tcId          String?
  lastValidDate DateTime?
  titles        String         @db.Text // JSON array olarak saklanacak
  status        MemberStatus   @default(ACTIVE)
  membershipDate DateTime
  // Yeni alanlar (opsiyonel)
  department    String?        // Bölüm
  graduationYear Int?           // Mezuniyet yılı
  occupation    String?        // Meslek
  // Sprint 5: Üye türü ve etiketler
  membershipKind MembershipKind @default(MEMBER)
  tags          Json?          // MemberTag array: ["HONORARY_PRESIDENT", "FOUNDING_PRESIDENT", etc.]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  boardMemberships BoardMember[]

  @@index([email])
  @@index([status])
  @@index([membershipDate])
  @@index([membershipKind])
}

enum MemberGender {
  erkek
  kadın
}

enum MemberAcademicLevel {
  ilkokul
  ortaokul
  lise
  onlisans
  lisans
  yukseklisans
  doktora
}

enum MemberMaritalStatus {
  bekar
  evli
  dul
  bosanmis
}

enum MemberStatus {
  ACTIVE
  INACTIVE
}

enum MembershipKind {
  MEMBER
  VOLUNTEER
}

// ============================================================================
// Membership Applications (Üyelik Başvuruları)
// ============================================================================

model MembershipApplication {
  id            String                    @id @default(uuid())
  firstName     String
  lastName      String
  gender        MemberGender
  email         String
  phone         String
  birthDate     DateTime
  academicLevel MemberAcademicLevel
  maritalStatus MemberMaritalStatus
  hometown      String
  placeOfBirth  String
  nationality   String
  currentAddress String                   @db.Text
  tcId          String?
  lastValidDate DateTime?
  status        ApplicationStatus         @default(PENDING)
  applicationDate DateTime                @default(now())
  reviewedAt    DateTime?
  reviewedBy    String?                   // AdminUser ID
  notes         String?                   @db.Text
  // Yeni alanlar (opsiyonel)
  department    String?                   // Bölüm
  reason        String?                    @db.Text // Başvuru nedeni
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt

  @@index([email])
  @@index([status])
  @@index([applicationDate])
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============================================================================
// Board Members (Yönetim Kurulu Üyeleri)
// ============================================================================

enum BoardRole {
  PRESIDENT
  VICE_PRESIDENT
  SECRETARY_GENERAL
  TREASURER
  BOARD_MEMBER
}

model BoardMember {
  id        String      @id @default(uuid())
  memberId String
  member   Member      @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  role      BoardRole
  termStart DateTime?
  termEnd   DateTime?
  
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([memberId])
  @@index([role])
}

// ============================================================================
// Events (Etkinlikler)
// ============================================================================

model Event {
  id              String   @id @default(uuid())
  title           String
  description     String   @db.Text
  shortDescription String  @db.Text
  date            DateTime
  location        String
  images          String   @db.Text // JSON array olarak saklanacak (Dataset ID'leri)
  featuredImage   String?  // Dataset ID
  isFeatured      Boolean  @default(false)
  requirements    String?  @db.Text // JSON array olarak saklanacak
  benefits        String?  @db.Text // JSON array olarak saklanacak
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([date])
  @@index([isFeatured])
}

// ============================================================================
// Scholarship Applications (Burs Başvuruları)
// ============================================================================

model ScholarshipApplication {
  id                      String                      @id @default(uuid())
  // Genel Bilgi
  fullName                String                      // name + surname birleştirilmiş
  email                   String                      @unique
  phone                   String
  alternativePhone        String?
  birthDate               DateTime
  birthPlace              String
  tcNumber                String
  idIssuePlace            String
  idIssueDate             DateTime
  gender                  String                      // "Erkek" | "Kadın"
  maritalStatus           String                      // "Bekar" | "Evli" | "Boşanmış" | "Dul"
  hometown                String
  permanentAddress        String                      @db.Text
  currentAccommodation    String                      @db.Text
  // Banka Bilgileri
  bankAccount             String
  ibanNumber              String
  // Üniversite Bilgileri
  university              String
  faculty                 String
  department              String?
  grade                   String                      // Sınıf bilgisi
  turkeyRanking           Int?                        // Türkiye sıralaması
  // Sağlık ve Engellilik
  physicalDisability      String                      // "Hayır" | "Evet"
  healthProblem           String                      // "Hayır" | "Evet"
  // Aile Bilgileri
  familyMonthlyIncome     Float
  familyMonthlyExpenses   Float
  scholarshipIncome       String                      // "Hayır" | "Evet"
  // Ek Bilgiler
  interests               String?                     @db.Text
  selfIntroduction        String                      @db.Text
  // İlişkili Veriler (JSON)
  relatives               Json?                       // relatives array
  educationHistory        Json?                       // educationHistory array
  references              Json?                       // references array
  documents               Json?                       // documents array (Dataset ID'leri)
  // Durum ve İnceleme
  status                  ScholarshipApplicationStatus @default(PENDING)
  reviewedBy              String?                     // AdminUser ID
  reviewedAt              DateTime?
  reviewNotes             String?                     @db.Text
  // Metadata
  createdAt               DateTime                    @default(now())
  updatedAt               DateTime                    @updatedAt

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([tcNumber])
}

enum ScholarshipApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

// ============================================================================
// Contact Messages (İletişim Mesajları)
// ============================================================================

model ContactMessage {
  id          String                @id @default(uuid())
  fullName    String
  email       String
  phone       String?
  subject     String
  message     String                @db.Text
  // Opsiyonel metadata
  ipAddress   String?
  userAgent   String?
  status      ContactMessageStatus  @default(NEW)
  createdAt   DateTime              @default(now())
  readAt      DateTime?
  archivedAt  DateTime?

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

enum ContactMessageStatus {
  NEW
  READ
  ARCHIVED
}

// ============================================================================
// Dataset (Görsel/Dosya Yönetimi)
// ============================================================================

model Dataset {
  id            String   @id @default(uuid())
  name          String
  description   String?  @db.Text
  category      String
  fileUrl       String   @db.MediumText // Base64 data URL (MEDIUMTEXT: 16MB limit)
  fileName      String
  fileSize      Int      // bytes
  fileType      String   // MIME type
  tags          String?  @db.Text // JSON array olarak saklanacak
  isPublic      Boolean  @default(true)
  downloadCount Int      @default(0)
  uploadedBy    String
  source        String   // 'event-upload', 'announcement-upload', vb.
  eventId       String?  // İlişkili event ID (opsiyonel)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([category])
  @@index([source])
  @@index([eventId])
  @@index([createdAt])
}
